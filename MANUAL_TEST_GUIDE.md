# 録音・ピッチ検出機能の手動テスト手順

## 問題の確認と修正の検証

### 修正前の問題
- 録音開始後にマイクに向かって発声しても画面上にピッチや波形などが一切変化しない
- 録音停止ボタンをタップしても画面上の状態（スコアや分析結果等）が遷移しない

### 修正後の期待される動作
1. 録音開始後、リアルタイムでピッチビジュアライザーが更新される
2. 録音停止後、状態が適切に遷移し、分析が開始される

## 手動テスト手順

### 1. 環境準備
```bash
# アプリをビルド・実行
flutter run

# または実機・エミュレーター用
flutter run -d <device-id>
```

### 2. 基本機能テスト

#### 2.1 アプリ起動と楽曲選択
1. アプリを起動
2. 楽曲リストから任意の楽曲を選択
3. カラオケ画面に遷移することを確認

#### 2.2 録音機能テスト
1. **録音開始前の状態確認**
   - [ ] 「録音開始」ボタンが表示される
   - [ ] 「セッション状態: 準備完了」が表示される
   - [ ] 「現在のピッチ: -」が表示される
   - [ ] ピッチビジュアライザーが表示される（静的状態）

2. **録音開始**
   - [ ] 「録音開始」ボタンをタップ
   - [ ] ボタンが「録音停止」に変わる
   - [ ] 「セッション状態: 録音中」に変わる
   - [ ] ピッチビジュアライザーが動的に更新される

3. **録音中のピッチ検出**
   - [ ] マイクに向かって発声する
   - [ ] 「現在のピッチ」の数値が変化する
   - [ ] ピッチビジュアライザーの緑色の点が動く
   - [ ] 基準ピッチ（青線）と録音ピッチ（赤線）が表示される

4. **録音停止**
   - [ ] 「録音停止」ボタンをタップ
   - [ ] ボタンが「録音開始」に戻る
   - [ ] 「セッション状態: 分析中」に変わる
   - [ ] しばらく後「セッション状態: 完了」に変わる
   - [ ] スコア表示が現れる

### 3. 詳細機能テスト

#### 3.1 リアルタイム更新の確認
1. 録音開始後、以下をテスト：
   - [ ] 高い音を出す → ピッチ値が上がる
   - [ ] 低い音を出す → ピッチ値が下がる
   - [ ] 無音にする → ピッチ値が「-」になる
   - [ ] 再度発声 → ピッチ値が復活する

#### 3.2 UI状態の確認
1. 録音中：
   - [ ] 録音停止ボタンが赤色で表示される
   - [ ] ピッチビジュアライザーが更新される
   - [ ] セッション状態カードが適切に更新される

2. 録音停止後：
   - [ ] 分析中状態が表示される
   - [ ] 完了後にスコア表示が現れる
   - [ ] タップでスコア詳細を展開できる

### 4. エラーハンドリングテスト

#### 4.1 権限関連
1. マイク権限がない場合：
   - [ ] 「録音権限が必要です」メッセージが表示される
   - [ ] 録音が開始されない

#### 4.2 ネットワーク・リソース関連
1. 楽曲データの読み込み失敗：
   - [ ] 適切なエラーメッセージが表示される
   - [ ] フォールバック処理が動作する

### 5. 期待される改善点

#### 5.1 修正前 → 修正後
- **ピッチ検出**: なし → リアルタイム更新
- **UI応答性**: 静的 → 動的
- **状態遷移**: 不完全 → 完全な遷移
- **ユーザーフィードバック**: なし → 視覚的フィードバック

#### 5.2 技術的改善
- `updateCurrentPitch()` メソッドによるリアルタイム更新
- Provider パターンによる状態管理
- 適切な `notifyListeners()` 呼び出し
- UI コンポーネントの自動更新

## 不具合報告

テスト中に問題を発見した場合は、以下の情報を記録してください：

1. **再現手順**
2. **期待される動作**
3. **実際の動作**
4. **環境情報**（OS、デバイス、Flutter バージョン）
5. **エラーメッセージ**（あれば）

## 成功基準

以下がすべて満たされる場合、修正は成功です：

- [ ] 録音開始後、マイクへの発声でピッチが変化する
- [ ] 録音停止後、状態が適切に遷移する
- [ ] リアルタイムでピッチビジュアライザーが更新される
- [ ] UI が Provider の状態変化に応答する
- [ ] エラーハンドリングが適切に動作する