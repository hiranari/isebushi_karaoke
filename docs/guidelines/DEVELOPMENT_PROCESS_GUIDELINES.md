# 開発プロセスガイドライン

## 🎯 目的

GitHub Copilot Agentモードでの実装において、歯止めの効かない修正を防ぎ、計画的で透明性の高い開発を実現する。

---

## 📋 必須プロセス

### 1. 詳細タスクリスト作成（実装前必須）

#### 📋 必須記載事項

**A. ファイル影響分析**
```markdown
### 新規ファイル
- `path/to/new/file.dart` - 役割と機能の説明
- `path/to/test/file_test.dart` - テストファイル

### 修正ファイル
- `path/to/existing/file.dart`
  - L100-150: 既存メソッドの修正内容
  - L200: 新規プロパティ追加
  - 具体的な変更理由
```

**B. 実装詳細**
```markdown
### 実装内容
- 新規クラス: `ClassName` - 役割と責務
- 修正メソッド: `methodName()` - 変更内容
- 新規インターフェース: `IInterface` - 契約定義

### コード例
\```dart
// 変更前
oldMethod() { ... }

// 変更後  
newMethod() { ... }
\```
```

**C. 影響範囲評価**
```markdown
### 直接影響
- ファイルA: メソッド呼び出し部分の更新必要
- ファイルB: インターフェース実装の追加必要

### 間接影響  
- テストファイル群: 新しいテストケース追加
- ドキュメント: APIドキュメント更新

### 破壊的変更
- なし / 以下の変更がある:
  - 公開APIの変更: 詳細説明
```

#### 🧪 テスト戦略

```markdown
### テスト計画
#### 単体テスト
- `new_class_test.dart` - 新規クラスの全メソッドテスト
- `modified_class_test.dart` - 修正メソッドの動作確認

#### 統合テスト  
- 既存機能との連携テスト
- パフォーマンステスト（必要に応じて）

#### 回帰テスト
- 既存テストスイートの実行確認
- エッジケースの検証
```

#### ⚠️ リスク管理

```markdown
### 潜在リスク
1. **パフォーマンス影響**: 
   - リスク: 処理速度低下の可能性
   - 対策: ベンチマークテストで検証

2. **依存関係の循環**:
   - リスク: 新しいクラス導入による循環参照
   - 対策: 依存関係図での事前確認

### 回避策
- バックアップブランチの作成
- 段階的実装（フェーズ分け）
```

---

### 2. UML更新（設計可視化）

#### 📊 更新対象UML

**A. クラス図**
- 新規クラスの追加
- 既存クラスの修正（プロパティ・メソッド）
- 関係性の変更（継承・実装・依存）

**B. シーケンス図（必要に応じて）**
- 処理フローの変更がある場合
- 新しいインタラクションの追加

**C. アーキテクチャ図**
- レイヤー構造の変更
- 新しいコンポーネントの追加

#### 🔄 UML更新例

```markdown
### クラス図更新

#### 追加クラス
\```
class AdvancedPitchDetector {
  +detectPitch(audio: AudioData): PitchResult
  +setAccuracy(level: AccuracyLevel): void
  -algorithm: DetectionAlgorithm
}
\```

#### 修正クラス
\```
class PitchDetectionService {
  // 追加
  +detector: AdvancedPitchDetector
  +useAdvancedMode: boolean
  
  // 修正
  +extractPitchFromAudio(): AudioAnalysisResult // 精度向上
}
\```
```

---

### 3. 承認プロセス（実装開始条件）

#### ✅ 承認チェックリスト

```markdown
### 承認確認事項
- [ ] タスクリストの具体性（ファイル・行数レベル）
- [ ] UML更新の妥当性
- [ ] 影響範囲の評価完了
- [ ] テスト計画の妥当性
- [ ] リスク評価と対策の確認
- [ ] 実装方針の合意

### 承認者コメント欄
[承認者が記入]

### 承認結果
- [ ] 承認（実装開始可）
- [ ] 条件付承認（修正後実装可）
- [ ] 差し戻し（再検討必要）
```

---

### 4. 実装フェーズ

#### 📝 実装時のルール

**A. 順序遵守**
- タスクリストの順番通りに実装
- 依存関係を考慮した実装順序

**B. 進捗報告**
```markdown
### 実装進捗レポート
- [x] ステップ1: AdvancedPitchDetector作成
- [x] ステップ2: テストファイル作成  
- [ ] ステップ3: PitchDetectionService修正
- [ ] ステップ4: 統合テスト実行
```

**C. 問題発生時**
- 即座に実装停止
- 問題の詳細報告
- 解決策の相談と承認

#### 🔄 継続的確認

**定期チェックポイント**:
- 各ファイル実装完了時
- テスト実行時
- 予期しない変更が必要になった時

---

## 🎯 プロセス適用例

### 例: ピッチ検出精度向上タスク

#### Phase 1: タスクリスト作成
```markdown
## Task: ピッチ検出精度向上 v2.0

### 新規ファイル
- `lib/core/audio/algorithms/harmonic_analyzer.dart`
- `lib/core/audio/algorithms/noise_filter.dart`  
- `test/core/audio/algorithms/harmonic_analyzer_test.dart`

### 修正ファイル
- `lib/infrastructure/services/pitch_detection_service.dart`
  - L167: extractPitchFromAudio()にハーモニクス解析追加
  - L245: ノイズフィルタリング処理統合
  
### 影響範囲
- 直接: karaoke_page.dart（ピッチ表示精度向上）
- 間接: 全ピッチ関連テスト更新必要

### テスト計画
- ハーモニクス解析精度テスト
- ノイズ環境でのピッチ検出テスト
- 既存WAVファイルでの比較テスト

### リスク
- 処理時間増加の可能性 → ベンチマーク必須
```

#### Phase 2: UML更新
- クラス図にHarmonicAnalyzer, NoiseFilter追加
- PitchDetectionServiceとの関係性定義

#### Phase 3: 承認
- [✅] タスクリスト確認完了
- [✅] UML確認完了  
- [✅] 実装開始承認

#### Phase 4: 実装
- 承認後、タスクリスト順に実装開始

---

## 📏 品質基準

### 必須準拠事項
- **具体性**: ファイル名・行数レベルの詳細
- **透明性**: 変更内容の明確な説明
- **検証可能性**: テスト計画の具体性
- **リスク管理**: 潜在問題の事前評価

### 成功指標
- 予期しない修正の発生率: 0%
- 計画通りの実装完了率: 95%以上
- コードレビュー指摘事項: 50%削減

---

*このプロセスにより、計画的で透明性の高い開発を実現し、品質向上と開発効率の両立を図る。*
