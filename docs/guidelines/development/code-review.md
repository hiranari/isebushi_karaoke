# コードレビューガイドライン

## 目的

高品質なコードベースを維持し、チーム全体の技術力向上を図るため、以下の目標を達成する：

- コードの品質と一貫性の確保
- バグの早期発見と予防
- ベストプラクティスの共有
- 知識の共有と技術的な議論の促進

## レビュープロセス

### 1. プルリクエスト作成時の確認事項

#### 基本情報
- 適切なブランチ名
- 明確なPRタイトル
- 変更内容の説明
- 関連Issueへのリンク

#### PRテンプレート
```markdown
## 変更内容
- 具体的な変更点をリストアップ

## 変更理由
- なぜこの変更が必要か

## テスト内容
- [ ] 単体テスト
- [ ] ウィジェットテスト
- [ ] 統合テスト
- [ ] 手動テスト

## スクリーンショット
（UI変更がある場合）

## 特記事項
- レビュワーへの注意点
- 既知の制限事項
```

### 2. レビュー優先度

#### Critical（最優先）
- 音声処理ロジックの変更
- ピッチ検出アルゴリズムの修正
- パフォーマンスに影響する変更
- セキュリティ関連の修正

#### High（優先）
- UIの主要な変更
- 状態管理ロジックの変更
- エラーハンドリングの実装

#### Normal（通常）
- 軽微なUI調整
- ドキュメント更新
- リファクタリング

### 3. レビュー観点

#### アーキテクチャ面
- [ ] クリーンアーキテクチャの原則に従っているか
- [ ] 適切な層に実装されているか
- [ ] 依存関係が適切か
- [ ] DIが正しく行われているか

#### コード品質
- [ ] DRY（Don't Repeat Yourself）原則
- [ ] SOLID原則の遵守
- [ ] 命名規則の一貫性
- [ ] コメントの適切性

#### パフォーマンス
- [ ] 不要なリビルドを避けているか
- [ ] メモリリークの可能性はないか
- [ ] 非同期処理の適切な使用
- [ ] リソースの適切な解放

#### セキュリティ
- [ ] ユーザー入力の適切なバリデーション
- [ ] センシティブな情報の適切な扱い
- [ ] 適切なパーミッション管理

#### テスト
- [ ] テストケースの網羅性
- [ ] エッジケースのテスト
- [ ] テストの可読性
- [ ] テストの独立性

## Flutter固有のレビューポイント

### 1. Widgetの実装

#### パフォーマンス
```dart
// ❌ 悪い例
class MyWidget extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    return Container(
      child: Text(DateTime.now().toString()), // 毎ビルド時に新しいインスタンス
    );
  }
}

// ✅ 良い例
class MyWidget extends StatelessWidget {
  const MyWidget({Key? key}) : super(key: key);
  
  @override
  Widget build(BuildContext context) {
    return const Text('Static Text'); // 定数ウィジェット
  }
}
```

#### 状態管理
- [ ] `StatefulWidget`の使用は適切か
- [ ] 状態管理ソリューションの適切な使用
- [ ] `BuildContext`の正しい使用

### 2. 音声処理関連

#### ピッチ検出
```dart
// ❌ 悪い例
void processPitch(List<double> audioData) {
  // メインスレッドでの重い処理
  final pitch = complexCalculation(audioData);
}

// ✅ 良い例
Future<void> processPitch(List<double> audioData) async {
  // 別スレッドでの処理
  final pitch = await compute(complexCalculation, audioData);
}
```

#### リソース管理
- [ ] 音声ストリームの適切な解放
- [ ] メモリ使用量の考慮
- [ ] バッファサイズの適切な設定

## レビューコメントのガイドライン

### 1. コメントの書き方

#### 建設的なフィードバック
```markdown
// ❌ 悪い例
このコードは良くない。

// ✅ 良い例
このピッチ検出処理は、メインスレッドで実行されているため
UIのフリーズを引き起こす可能性があります。
`compute`を使用して別スレッドで実行することを提案します。
```

#### 提案を含める
```markdown
以下のような実装はいかがでしょうか：
```dart
Future<void> processPitch(List<double> audioData) async {
  final pitch = await compute(complexCalculation, audioData);
}
```
```

### 2. レビューのトーン

#### ポジティブな表現
- 「〜してはどうでしょうか」
- 「〜という方法も考えられます」
- 「〜するとさらに良くなりそうです」

#### 避けるべき表現
- 断定的な否定
- 個人的な好み
- 感情的な表現

## レビュー完了の条件

### 1. チェックリスト

- [ ] すべてのコメントが解決済み
- [ ] CIパイプラインが成功
- [ ] テストがパス
- [ ] コードカバレッジが基準を満たす
- [ ] ドキュメントが更新されている

### 2. 承認条件

#### 必須レビュワー
- 機能オーナー
- アーキテクチャ担当者（主要な変更の場合）

#### 承認数
- 通常の変更: 1名以上
- 重要な変更: 2名以上

## 効率的なレビュープロセス

### 1. タイムライン

- PRオープンから24時間以内に最初のレビュー
- コメント対応は48時間以内
- 緊急の場合は個別に相談

### 2. サイズガイドライン

#### 推奨PRサイズ
- 変更行数: 300行以下
- 変更ファイル数: 10ファイル以下

#### 大規模な変更の場合
- 複数のPRに分割
- 段階的なマージ
- 詳細な実装計画の共有

## レビュー文化の醸成

### 1. 知識共有

- レビューでの学びをチーム内で共有
- 定期的なベストプラクティスの更新
- コードレビューミーティングの開催

### 2. 継続的な改善

- レビュープロセスの定期的な見直し
- フィードバックの収集
- ガイドラインの更新

## 付録

### A. プルリクエストサイズの目安

| 種類 | 推奨サイズ | レビュワー数 |
|------|------------|--------------|
| 小規模 | 〜100行 | 1名 |
| 中規模 | 100-300行 | 1-2名 |
| 大規模 | 300行〜 | 2名以上 |

### B. コードレビューチェックリスト

```markdown
## 機能面
- [ ] 要件を満たしているか
- [ ] エッジケースの考慮
- [ ] エラーハンドリング

## 技術面
- [ ] アーキテクチャの一貫性
- [ ] パフォーマンスへの影響
- [ ] セキュリティ考慮

## 品質面
- [ ] テストの網羅性
- [ ] コードの可読性
- [ ] ドキュメントの更新
```
